# GPT Prompt 생성

https://drive.google.com/drive/folders/1sAfXBE6nBeT0vBFB3DHEXVdb_3ApoDaB

https://www.notion.so/Prompt-Engineering-Chatbot-20df5bfb011080299a68c1985078b635?source=copy_link
> **주제: 한국 보험 약관의 해석 및 비판적 분석-반려묘 보험을 중심으로** <br/><br/>
<details>
<summary> 
 
 ## Topic: Interpretation and critical analysis of Korean insurance terms
</summary>
<p>

 
# Step 0: RAG 문서 준비 및 벡터 스토어 구축

### 목표: 잠재적 문제점 발상 및 개선 방안 모색에 도움이 될 만한 다양한 외부 정보 문서들을 수집하고, Langchain이 활용할 수 있는 벡터 스토어 형태로 변환
### 필요한 문서
  * 분석 대상 보험 약관 원문 PDF: 필수 (samsung_direct_path_1) 약관 자체를 벡터 스토어에 넣어두면 특정 조항의 상세 내용을 빠르게 검색해서 근거 활용 가능
  * 다른 보험 약관 원문 PDF들: 다양한 유형의 약관을 넣어두면 특정 문제가 다른 약관에서는 어떻게 규정되어 있는지 비교하거나, 일반적인 보험 약관의 문제점 패턴 파악에 도움 ㄱㄴ ( 어린이 보험, 암 보험, 여행자 보험, 자동차 보험, 생명 보험 등 다양한 약관 PDF들)
  * 금융감독원 분쟁 조정 사례집: 보험 분쟁 사례집은 실제 약관 조항 해석이나 적용에서 어떤 문제가 발생하고, 금감원은 어떻게 판단했는지 구체적인 예시를 담고 있어 GPT가 현실적인 문제점을 발상하고 그 근거를 찾는 데 결정적인 도움 줄 수도? (금융감독원 자료 검색)
  * 보험 관련 법규 및 약관 규제 관련 자료: 「보험업법」, 「약관의 규제에 관한 법률」 등 보험 및 약관 관련 법규나 금융위원회의 약관 심사 관련 자료 등을 넣어두면 약관의 법적 문제점이나 규제 위반 가능성 분석에 유용
  * 특정 질병/상해 관련 의학 정보 (선택적): 만약 약관에 특정 질병이나 상해 관련 조항(예: 특정 질병의 진단 기준, 특정 치료 방법 등)이 중요한 문제점의 대상이 된다면, 해당 질병/치료에 대한 신뢰할 수 있는 의학 정보 자료를 추가하면 분석의 정확도 향상 가능
  * 소비자원 피해 구제 사례: 한국소비자원에서 공개하는 보험 관련 피해 구제 사례들도 실제 소비자들이 어떤 문제를 겪는지 생생한 정보 제공으로 문제점 발상 도움.

### 작업 내용:
* 수집한 모든 문서(주로 PDF)를 로드, PyMuPDF 같은 라이브러리 사용

* 로드된 문서의 텍스트를 Langchain의 TextSplitter로 적절한 크기의 '청크'로 split

* 나눠진 각 청크를 OpenAIEmbeddings 같은 임베딩 모델로 벡터(숫자 배열)로 변환

* 변환된 벡터들을 Chroma나 FAISS 같은 벡터 스토어에 저장

-----
# Step 1: 약관 원문 '심층 이해' (CoT 집중, RAG 활용)

### 목표: 분석 대상 약관 문구를 정확히 이해. RAG를 통해 관련 외부 정보를 참고하며 이해의 깊이 확장
### 수정 내용:
* 주어진 약관 문구를 읽을 때, 동시에 벡터 스토어에서 해당 문구와 관련된 정보를 검색. (Langchain Retriever 사용)

* 검색된 관련 정보(예: 분쟁 사례, 관련 법규 조항)를 약관 문구와 함께 GPT 프롬프트에 넣음

* GPT는 약관 문구와 검색된 외부 정보를 모두 참고해 약관의 의미 심층적 파악 가능

* CoT처럼 단계별 이해 과정을 프롬프트에 포함시켜서 정확한 이해 유도

* 챗봇의 사용 시나리오별 응답 유형 설계

    * 설명형 / 비교형 / 사례 기반형 응답 프롬프트 패턴 구분
 
--------
# Step 2: 잠재적 '문제점 발상' 및 근거 제시 (ToT 발상 + CoT 근거, RAG 필수 활용)

### 목표: 약관의 잠재적 문제점을 다양하게 발상하고, 그 근거를 제시하는 것. 이때 RAG를 적극적으로 활용해서 더 현실적이고 근거가 풍부한 문제점을 발상
### 수정 내용:
* 잠재적 문제점 발상을 시킬 때, **GPT 프롬프트에 분석 대상 약관 원문 텍스트와 함께 Step 1에서 검색된 외부 참고 자료(벡터 스토어 검색 결과)**를 반드시 포함

* 프롬프트 지침에 "제공된 약관 내용과 **추가 참고 자료**를 꼼꼼히 비교하며 문제점을 발상하라"고 명시


* 특히 문제점의 '근거 및 추론 과정' (CoT) 부분을 설명할 때, 약관 원문의 어떤 문구와 더불어 추가 참고 자료의 어떤 내용을 참고해서 그 문제점을 발상하게 되었는지 구체적으로 언급하도록 유도. (예: "약관 제X조 Y항 내용과 금감원 분쟁 사례집 Z 페이지의 유사 사례를 보니 이런 문제가 발생할 수 있습니다.")


* 이전 약관 전체 요약 내용도 여전히 컨텍스트로 함께 제공해서 전체 맥락 따름.


* ToT 발상 단계이므로 temperature는 좀 높게 유지, Self-consistency로 여러 후보를 생성하고 안정적인 목록을 선택하는 것은 동일 적용.
-----
# Step 3: 문제점 '평가' 및 중요 문제 선정 (ToT 평가, RAG 활용 가능)

### 목표: 발상된 문제점 후보들을 중요도 기준으로 평가하고 최적을 선정하는 것. 평가 기준을 판단할 때 RAG로 추가 정보를 얻으면 더 객관적인 평가 가능.
### 수정 내용:
* 문제점 후보들을 평가할 때, 각 문제점과 관련된 약관 원문 및 Step 2에서 문제점 발상 시 사용되었던 외부 참고 자료와 함께 GPT 프롬프트에 넣음

* 프롬프트 지침에 "제시된 문제점 후보와 관련 약관 및 **[참고 자료]**를 바탕으로 심각성, 발생 가능성, 모호성 등을 평가하라"고 명시
* 평가 기준(심각성, 발생 가능성 등)을 판단할 때 RAG로 검색된 새로운 외부 정보 (예: 특정 문제점 유형에 대한 최근 통계, 최신 법원 판례 등)를 추가로 제공하여 평가의 정확성을 높일 수 있음 (평가 단계마다 검색해야 해서 복잡해질 수 있음)

* 평가 결과를 JSON으로 받고, 총점 기준으로 순위 매겨 최적 문제점을 선정하는 것은 동일.

### ✅ 현재 Step 3에서의 추천 진행 방향
*  문제점 리스트를 구조화 (JSON/표 형태)
    → 문제점 - 관련 조항 - 외부 자료 인용 - 심각성 점수 - 모호성 점수 - 발생 가능성 등 항목화

* 문제점에 대해 재검색 기능 활성화 (RAG Loop)
    → 특정 문제점이 ‘다른 약관’에도 나타나는지 RAG로 다시 검색해 비교 가능

심각도 판단 시 “최근 분쟁/판례/민원 통계” 활용 가능
→ 예: “이 문제는 실제로 2023년 한 해에 민원 500건 이상이었음” 등

----
# Step 4: '개선 방안 발상' 및 효과 설명 (ToT 발상 + CoT 효과, RAG 필수 활용)

###  목표: 선택된 핵심 문제점을 해결하기 위한 창의적이고 실현 가능한 개선 방안 발상. 이때도 RAG를 적극 활용해서 현실적인 방안 도출
###수정 내용:
* 개선 방안 발상시, GPT 프롬프트에 **Step 3에서 선정된 '핵심 문제점'의 상세 내용(요약, 근거 포함)과 더불어, 약관 원문 및 관련 외부 참고 자료(벡터 스토어 검색 결과)**를 반드시 포함


* 프롬프트 지침에 "제시된 핵심 문제점과 관련 약관 및 **추가 참고 자료**를 바탕으로 효과적인 개선 방안을 발상하라"고 명시. 특히 "다른 약관에서는 이 문제를 어떻게 해결하고 있는지 **[참고 자료]**를 통해 확인하고 아이디어를 얻으라"고 지시 가능.

* 개선 방안의 '해결 논리 및 기대 효과' (CoT) 부분을 설명할 때, 어떤 개선 방안을 적용하면 -> 약관의 어떤 문구가 어떻게 바뀌고/추가 안내가 제공되며 -> 이게 어떤 논리적 과정을 거쳐 핵심 문제점을 해결하고 -> 어떤 긍정적인 효과(소비자 이해도 증가, 분쟁 감소 등)가 나타나는지, 그리고 이를 뒷받침할 만한 외부 참고 자료의 내용은 없는지 구체적으로 설명하도록 유도

* ToT 발상 단계이므로 temperature는 높게, Self-consistency는 동일 적용.

-----

# Step 5: 개선 방안 '평가' 및 최적 방안 선정 (ToT 평가, RAG 활용 가능)

### 목표: 발상된 개선 방안 후보 평가 후 최적 선정. 평가 기준을 판단할 때 RAG로 추가 정보를 얻으면 더 객관적인 평가 가능.
### 수정 내용:
* 개선 방안 후보들을 평가 시, 각 후보와 관련된 약관 원문, 핵심 문제점 상세 내용, 그리고 Step 4에서 개선 방안 발상 시 사용되었던 외부 참고 자료를 함께 GPT 프롬프트에 넣어주기
* 프롬프트 지침에 "제시된 개선 방안 후보와 관련 정보 및 **[참고 자료]**를 바탕으로 문제 해결 효과, 실현 가능성, 소비자 친화성 등을 평가하라"고 명시.
* 평가 기준(실현 가능성, 비용 등) 판단 시 RAG로 검색된 새로운 외부 정보 (예: 특정 개선 방안 적용에 필요한 시스템 구축 비용 자료, 관련 규제 변경 동향 등)를 추가로 제공 가능
* 평가 결과를 JSON으로 받고, 총점 기준으로 순위 매겨 최적 개선 방안을 선정하는 것은 동일.

### ✅ Step 5: 개선 방안 평가 및 최종 선택 (ToT 평가 + 사용자 대화형 추천)
#### 변경 사항 요약:

* 챗봇이 개선안 리스트에 대해 "가장 추천하는 1~2개"를 자동 추천하거나, 사용자 선택 유도형으로 변경

* 사용자가 챗봇에게 "비용 낮은 것만 보여줘", "실현 가능성 높은 거 위주로" 같은 프롬프트 요청 시 선택 가중치 변경 가능하도록 설계

--------
# 🔁 추가 제안: Step 6 - 사용자 정의 챗봇 구성 및 커스터마이징
목표: 위의 Step들을 프롬프트 흐름에 따라 결합해, 실제 대화형 챗봇으로 구현하는 단계

📌 기능:

사용자 프롬프트에 따라 Step 1~5 중 하나 또는 연속 흐름 실행

Langchain의 ConversationalRetrievalChain 또는 MultiPromptChain을 활용하여 단계별 프롬프트 자동 선택

사용자가 프롬프트 직접 구성할 수 있도록 템플릿 추천
</p>
</details>

## Chatbot Screen with Streamlit 1

![Image](https://github.com/user-attachments/assets/f7c87bc4-e935-46a0-a790-b7ca949d07c6)

## Chatbot Screen with Streamlit 2

![Image](https://github.com/user-attachments/assets/60808071-df09-48f9-bc3a-0de30a3dafe6)


### 1. 🧠 프로젝트 개요

| 항목 | 내용 |
| --- | --- |
| **프로젝트명** | 보험 약관 분석 기반 대화형 챗봇 |
| **목표** | 한국 보험 약관(반려묘 중심)의 문제점을 RAG + GPT 기반 분석, 개선안 도출, 평가 및 사용자 친화 챗봇 구현 |
| **사용자 대상** | 보험 소비자, 설계사, 약관 분석자 등 |
| **핵심 기술** | LangChain, GPT-4o, Streamlit, VectorDB, Tree of Thought, RAG, 평가 자동화 |

---

### 2. 🔁 전체 프로세스 흐름 (Step 1~6)

| 단계 | 설명 | 입력 | 출력 |
| --- | --- | --- | --- |
| Step 1 | 약관 요약 | 원문 PDF / TXT | 요약 JSON |
| Step 2 | 문제점 도출 | 요약 JSON | 문제점 JSON |
| Step 3 | 문제 평가 | 문제점 JSON | 평가 JSON |
| Step 4 | 개선안 생성 | 문제 + 외부 검색 | 개선안 JSON |
| Step 5 | 개선안 평가 | 개선안 + RAG | 평가 결과 JSON |
| Step 6 | 챗봇 통합 | 위 JSON + QA | 사용자 챗봇 인터페이스 |

---

### 3. 📁 구조 설명과 역할 정리 가이드

```bash
코드 복사
📁 cn_api_project/
├── data/
│   └── 보험약관/
│       └── summary/
├── step2_results/
├── step3_results/
├── merged_step4_results/
├── step5_results/
├── app/
│   ├── app.py                  # streamlit 앱 실행 파일
│   ├── chains/
│   │   ├── step2_chain.py
│   │   ├── step3_chain.py
│   │   ├── step4_chain.py
│   │   ├── step5_chain.py
│   │   └── router_chain.py
│   ├── components/
│   │   └── cat_easter_egg.py   # 귀여운 고양이 이스터에그
│   ├── utils/
│   │   └── prompt_templates.py
│   └── vectorstore/
│       └── chroma_db/

```

#### **🔹 `data/`**

- **역할**: 정적 데이터 원본 저장소 (약관 등)
- **세부 정리**:
    - `보험약관/summary/`: 각 보험 상품의 요약 텍스트 파일

> ✅ 여기에는 사람이 직접 만든 자료나 외부에서 수집한 원본 데이터만 위치
> 

---

#### **🔹 `step2_results/`, `step3_results/`, `merged_step4_results/`, `step5_results/`**

- **역할**: 단계별 처리 결과 저장
- **정리 기준**:
    - JSON 또는 텍스트 파일이 **"자동 생성" 또는 "스크립트 출력물"** 일 때 여기에 저장
    - 정리 시에는 파일 이름에 `step{번호}_{보험명}.json` 형식 유지

> ✅ 여긴 모델 결과물이 저장되는 중간/최종 결과 디렉토리
> 

---

#### **🔹 `app/`**

- 전체 앱 실행 코드

**📄 `app.py`**

- Streamlit 실행 진입점
- 탭/버튼 등을 배치하고 `chains/`, `components/` 등을 호출

---

#### **🔹 `app/chains/`**

- **역할**: LangChain 기반 체인 구성 정의
- **파일별 정리 기준**:
